<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Admin Dashboard | Student Portal</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<style>
    body { background-color: #F5F6FA; font-family: Arial, sans-serif; }
    .navbar { background-color: #0A3D62; }
    .navbar-brand { color: #ffffff !important; }
    .btn-light { color: #000000 !important; }
    .card { border-radius: 12px; cursor: pointer; transition: 0.3s; }
    .card:hover { transform: scale(1.05); }
    .card-title { color: #0A3D62; font-weight: bold; }
    .section { display: none; margin-top: 20px; }
    .section h4 { color: #0A3D62; }
</style>
</head>
<body>

<nav class="navbar navbar-dark">
    <div class="container">
        <span class="navbar-brand">Admin Dashboard</span>
        <a href="Login.html" class="btn btn-light btn-sm">Logout</a>
    </div>
</nav>

<div class="container mt-5">
    <h3>Welcome Admin</h3>

    <div class="row g-4 mt-4">
        <div class="col-md-4"><div class="card p-4 text-center" onclick="showSection('students')">
            <h5 class="card-title">Manage Students</h5><p>Add, edit or delete students</p>
        </div></div>
        <div class="col-md-4"><div class="card p-4 text-center" onclick="showSection('teachers')">
            <h5 class="card-title">Manage Teachers</h5><p>Add, edit or delete teachers</p>
        </div></div>
        <div class="col-md-4"><div class="card p-4 text-center" onclick="showSection('reports')">
            <h5 class="card-title">Manage Reports</h5><p>View attendance & results</p>
        </div></div>
        <div class="col-md-4"><div class="card p-4 text-center" onclick="showSection('queries')">
            <h5 class="card-title">Manage Queries</h5><p>View user contact queries</p>
        </div></div>
    </div>

    <div id="students" class="section">
        <h4>Students</h4>
        <input type="text" class="form-control mb-2" id="studentSearch" placeholder="Search by ID or Name..." onkeyup="searchTable('studentTable', 'studentSearch')">
        <button class="btn btn-primary mb-2" onclick="openStudentModal()">Add Student</button>
        <div id="studentTable"></div>
        
    </div>

    <div id="teachers" class="section">
        <h4>Teachers</h4>
        <input type="text" class="form-control mb-2" id="teacherSearch" placeholder="Search by ID, Name, Department..." onkeyup="searchTable('teacherTable', 'teacherSearch')">
        <button class="btn btn-primary mb-2" onclick="openTeacherModal()">Add Teacher</button>
        <div id="teacherTable"></div>
    </div>

    <div id="reports" class="section">
        <h4>Reports</h4>
        <div class="mb-3">
            <button class="btn btn-primary me-2" onclick="showReport('results')">Manage Results</button>
            <button class="btn btn-secondary" onclick="showReport('attendance')">Manage Attendance</button>
        </div>

        <input type="text" class="form-control mb-2" id="resultsSearch" placeholder="Search by Student, Course..." onkeyup="searchTable('resultsTable', 'resultsSearch')" style="display:none;">
        <div id="resultsTable" style="display:none;"></div>

        <input type="text" class="form-control mb-2" id="attendanceSearch" placeholder="Search by Student, Subject, Status..." onkeyup="searchTable('attendanceTable', 'attendanceSearch')" style="display:none;">
        <div id="attendanceTable" style="display:none;"></div>
    </div>


    <div id="queries" class="section">
        <h4>User Queries</h4>
         <input type="text" class="form-control mb-2" id="querySearch" placeholder="Search by Name, Email or Phone..." onkeyup="searchTable('queryTable', 'querySearch')">
        <div id="queryTable"></div>
    </div>

</div>

<div class="modal fade" id="studentModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="studentForm" method="POST" action="add_student.php">
        <div class="modal-header">
          <h5 class="modal-title" id="studentModalTitle">Add Student</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label>ID</label>
            <input type="text" class="form-control" name="StudentID" id="StudentID" required>
          </div>
          <div class="mb-3">
            <label>Name</label>
            <input type="text" class="form-control" name="Name" id="StudentName" required>
          </div>
          <div class="mb-3">
            <label>Email</label>
            <input type="email" class="form-control" name="Email" id="StudentEmail" required>
          </div>
          <div class="mb-3">
            <label>Password</label>
            <input type="text" class="form-control" name="Password" id="StudentPassword" required>
          </div>
          <div class="mb-3">
            <label>Department</label>
            <select class="form-select" name="Department" id="StudentDept" required>
                <option value="" selected disabled>Select Department</option>
                <option value="Software Engineering">Software Engineering</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Business Admin">Business Admin</option>
                <option value="Pharmacy">Pharmacy</option>
                <option value="English">English</option>
                <option value="Electrical Engineering">Electrical Engineering</option>
                <option value="Artificial Intelligence">Artificial Intelligence</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<div class="modal fade" id="teacherModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="teacherForm" method="POST" action="add_teacher.php">
        <div class="modal-header">
          <h5 class="modal-title" id="teacherModalTitle">Add Teacher</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
        </div>
        <div class="modal-body">
          <div class="mb-3">
            <label>ID</label>
            <input type="text" class="form-control" name="TeacherID" id="TeacherID" required>
          </div>
          <div class="mb-3">
            <label>Name</label>
            <input type="text" class="form-control" name="Name" id="TeacherName" required>
          </div>
          <div class="mb-3">
            <label>Email</label>
            <input type="email" class="form-control" name="Email" id="TeacherEmail" required>
          </div>
          <div class="mb-3">
            <label>Password</label>
            <input type="text" class="form-control" name="Password" id="TeacherPassword" required>
          </div>
          <div class="mb-3">
            <label>Department</label>
            <select class="form-select" name="Department" id="TeacherDept" required>
                <option value="" selected disabled>Select Department</option>
                <option value="Software Engineering">Software Engineering</option>
                <option value="Computer Science">Computer Science</option>
                <option value="Business Admin">Business Admin</option>
                <option value="Pharmacy">Pharmacy</option>
                <option value="English">English</option>
                <option value="Electrical Engineering">Electrical Engineering</option>
                <option value="Artificial Intelligence">Artificial Intelligence</option>
            </select>
          </div>
        </div>
        <div class="modal-footer">
          <button type="submit" class="btn btn-primary">Save</button>
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script>
function showSection(section) {
    document.querySelectorAll('.section').forEach(sec => sec.style.display='none');
    document.getElementById(section).style.display='block';

    if(section==='students') loadStudents();
    else if(section==='teachers') loadTeachers();
    else if(section==='reports') showReport('results');
    else if (section === 'queries') loadQueries();
}

// Modals
function openStudentModal() {
    document.getElementById('studentForm').reset();
    document.getElementById('StudentID').value = '';
    document.getElementById('studentModalTitle').innerText = 'Add Student';
    new bootstrap.Modal(document.getElementById('studentModal')).show();
}

function openTeacherModal() {
    document.getElementById('teacherForm').reset();
    document.getElementById('TeacherID').value = '';
    document.getElementById('teacherModalTitle').innerText = 'Add Teacher';
    new bootstrap.Modal(document.getElementById('teacherModal')).show();
}

// Load tables
function loadStudents(){
    fetch('fetch_students.php')
    .then(res=>res.text())
    .then(data=>document.getElementById('studentTable').innerHTML=data);
}

function loadTeachers(){
    fetch('fetch_teachers.php')
    .then(res=>res.text())
    .then(data=>document.getElementById('teacherTable').innerHTML=data);
}

// Reports
function showReport(type){
    // Hide both tables and search bars
    document.getElementById('resultsTable').style.display='none';
    document.getElementById('attendanceTable').style.display='none';
    document.getElementById('resultsSearch').style.display='none';
    document.getElementById('attendanceSearch').style.display='none';

    if(type==='results'){
        document.getElementById('resultsTable').style.display='block';
        document.getElementById('resultsSearch').style.display='block';
        loadResults();
    } else if(type==='attendance'){
        document.getElementById('attendanceTable').style.display='block';
        document.getElementById('attendanceSearch').style.display='block';
        loadAttendance();
    }
}

function loadResults(){
    fetch('fetch_results.php')
    .then(res=>res.text())
    .then(data=>document.getElementById('resultsTable').innerHTML=data);
}

function loadAttendance(){
    fetch('fetch_attendance.php')
    .then(res=>res.text())
    .then(data=>document.getElementById('attendanceTable').innerHTML=data);
}
function openAttendanceModal() {
    document.getElementById('attendanceForm').reset();
    document.getElementById('AttendanceID').value = '';
    new bootstrap.Modal(document.getElementById('attendanceModal')).show();
}

document.getElementById('attendanceForm').onsubmit = function(e){
    e.preventDefault();
    fetch('save_attendance.php', {
        method: 'POST',
        body: new FormData(this)
    }).then(() => {
        loadAttendance();
        bootstrap.Modal.getInstance(
            document.getElementById('attendanceModal')
        ).hide();
    });
};

function deleteAttendance(id){
    if(confirm("Delete attendance?")){
        fetch('delete_attendance.php?id=' + id)
        .then(() => loadAttendance());
    }
}


function loadQueries() {
    fetch('fetch_queries.php')
    .then(res => res.text())
    .then(data => document.getElementById('queryTable').innerHTML = data);
}
function searchTable(tableId, inputId) {
    let input = document.getElementById(inputId);
    let filter = input.value.toUpperCase();
    let table = document.getElementById(tableId);
    let rows = table.getElementsByTagName("tr");

    for (let i = 1; i < rows.length; i++) { // start from 1 to skip table header
        let cells = rows[i].getElementsByTagName("td");
        let found = false;
        for (let j = 0; j < cells.length; j++) {
            if (cells[j].innerText.toUpperCase().indexOf(filter) > -1) {
                found = true;
                break;
            }
        }
        rows[i].style.display = found ? "" : "none";
    }
}
</script>

</body>
</html>